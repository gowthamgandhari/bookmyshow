    ******************************NOTE FOR DELETION USE THIS GROOVY SCRIPT*******************************************************

-------Instead of Manual deletion here i used parameters to --destroy resources via pipeline --------

pipeline {
    agent any

    environment {
        AWS_REGION      = 'ap-south-1'
        TF_STATE_BUCKET = 'bms-tf-state-bucket'
        TF_LOCK_TABLE   = 'bms-tf-lock'
        ACTION          = 'destroy' 
    }

    stages {

        stage('Terraform Destroy EKS Infra') {
            steps {
                withAWS(credentials: 'aws-creds', region: "${AWS_REGION}") {
                    dir('Terraform-Code-for-EKS-Cluster/terraform') {
                        sh '''
                            echo "üö® Destroying Terraform-managed infrastructure..."
                            terraform init -input=false
                            terraform destroy -auto-approve
                        '''
                    }
                }
            }
        }

        stage('Delete S3 Backend Bucket') {
            steps {
                withAWS(credentials: 'aws-creds', region: "${AWS_REGION}") {
                    sh '''
                        if aws s3api head-bucket --bucket ${TF_STATE_BUCKET} 2>/dev/null; then
                            echo "üßπ Deleting S3 bucket: ${TF_STATE_BUCKET}"
                            aws s3 rm s3://${TF_STATE_BUCKET} --recursive
                            aws s3api delete-bucket --bucket ${TF_STATE_BUCKET} --region ${AWS_REGION}
                        else
                            echo "‚ÑπÔ∏è S3 bucket does not exist. Skipping."
                        fi
                    '''
                }
            }
        }

        stage('Delete DynamoDB Lock Table') {
            steps {
                withAWS(credentials: 'aws-creds', region: "${AWS_REGION}") {
                    sh '''
                        if aws dynamodb describe-table --table-name ${TF_LOCK_TABLE} 2>/dev/null; then
                            echo "üßπ Deleting DynamoDB table: ${TF_LOCK_TABLE}"
                            aws dynamodb delete-table --table-name ${TF_LOCK_TABLE}
                            aws dynamodb wait table-not-exists --table-name ${TF_LOCK_TABLE}
                        else
                            echo "‚ÑπÔ∏è DynamoDB table does not exist. Skipping."
                        fi
                    '''
                }
            }
        }

    }

    post {
        success {
            echo '‚úÖ FULL INFRA DESTROY COMPLETED SUCCESSFULLY'
        }
        failure {
            echo '‚ùå DESTROY PIPELINE FAILED ‚Äî CHECK LOGS'
        }
        always {
            echo "Destroy pipeline finished with status: ${currentBuild.currentResult}"
        }
    }
}
